<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TPRGS ‚Äì Client Portal (Mock)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{ --brand:#0ea5e9; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444; --muted:#64748b; }
    .card{ background:#fff; border:1px solid #e2e8f0; border-radius:16px; padding:18px; box-shadow:0 1px 2px rgba(0,0,0,.03); }
    .pill{ display:inline-block; padding:.2rem .6rem; border-radius:999px; font-size:.72rem; }
    .bar{ height:10px; border-radius:999px; background:#e2e8f0; overflow:hidden }
    .bar > i{ display:block; height:100%; background:var(--brand) }
    .mono{ font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
    .link{ color:#0ea5e9 }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- Header -->
  <header class="sticky top-0 z-20 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl flex items-center justify-center text-white font-bold" style="background:#0ea5e9">CL</div>
        <div>
          <div class="font-semibold">TPRGS.COM</div>
          <div class="text-xs text-slate-500">Client Portal ‚Ä¢ ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <select id="projectSelect" class="px-3 py-2 rounded-xl border border-slate-200 text-sm"></select>
        <button id="btn-export" class="px-3 py-2 rounded-xl bg-slate-900 text-white text-sm">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (PNG)</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 space-y-8">
    <!-- 1. Project Status Overview -->
    <section>
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">1) ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (Project Status Overview)</h2>
        <span class="text-xs text-slate-500">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚Ä¢ ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
        <!-- Summary -->
        <div class="card lg:col-span-5">
          <div class="flex items-center justify-between mb-1">
            <div class="font-semibold">Project Summary</div>
            <span id="overallPill" class="pill bg-sky-100 text-sky-700">In Progress</span>
          </div>
          <div class="text-sm text-slate-600" id="projectDesc"></div>
          <dl class="grid grid-cols-2 gap-3 mt-4 text-sm">
            <div class="p-3 rounded-xl border border-slate-200">
              <dt class="text-slate-500">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</dt>
              <dd class="font-medium" id="projectName">-</dd>
            </div>
            <div class="p-3 rounded-xl border border-slate-200">
              <dt class="text-slate-500">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</dt>
              <dd class="font-medium" id="pmName">-</dd>
            </div>
            <div class="p-3 rounded-xl border border-slate-200">
              <dt class="text-slate-500">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</dt>
              <dd class="font-medium mono" id="budget">-</dd>
            </div>
            <div class="p-3 rounded-xl border border-slate-200">
              <dt class="text-slate-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</dt>
              <dd class="font-medium" id="startDate">-</dd>
            </div>
          </dl>
          <div class="mt-4">
            <div class="text-xs text-slate-500 mb-1">% ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
            <div class="bar"><i id="progressBar" style="width:0%"></i></div>
            <div class="text-xs text-right mt-1"><span id="progressTxt" class="mono">0%</span></div>
          </div>
          <div class="mt-4">
            <div class="font-medium mb-2">Milestones ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
            <ul id="milestones" class="space-y-2 text-sm"></ul>
          </div>
        </div>
        <!-- % Complete chart -->
        <div class="card lg:col-span-3">
          <div class="font-semibold mb-2">% Complete</div>
          <div class="h-56"><canvas id="chartPercent"></canvas></div>
          <div class="text-xs text-slate-500 mt-1">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div>
        </div>
        <!-- Key quick links -->
        <div class="card lg:col-span-4">
          <div class="font-semibold mb-2">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πà‡∏ß‡∏ô</div>
          <div class="grid grid-cols-2 gap-3 text-sm">
            <a href="#invoices" class="p-3 rounded-xl border border-slate-200 hover:bg-slate-50">üìÑ ‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
            <a href="#docs" class="p-3 rounded-xl border border-slate-200 hover:bg-slate-50">üìÇ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå</a>
            <a href="#reports" class="p-3 rounded-xl border border-slate-200 hover:bg-slate-50">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</a>
            <a href="#" class="p-3 rounded-xl border border-slate-200 hover:bg-slate-50" id="btn-contact-pm">üí¨ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ PM</a>
          </div>
          <div class="text-xs text-slate-500 mt-3">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô Timesheets, ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô, ‡∏Å‡∏≥‡πÑ‡∏£ ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ó‡∏±‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
        </div>
      </div>
    </section>

    <!-- 2. Invoice & Payments -->
    <section id="invoices">
      <h2 class="text-lg font-semibold mb-3">2) ‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Invoices & Payments)</h2>
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
        <div class="card lg:col-span-8">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">Invoice List</div>
            <div class="flex items-center gap-2">
              <select id="invFilter" class="px-3 py-1.5 rounded-xl border border-slate-200 text-xs">
                <option value="all" selected>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="unpaid">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</option>
                <option value="overdue">‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option>
                <option value="paid">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option>
              </select>
              <button class="px-3 py-1.5 rounded-xl bg-slate-100 text-slate-700 text-xs" id="btn-download-csv">Export CSV</button>
            </div>
          </div>
          <table class="w-full text-sm">
            <thead class="text-slate-500">
              <tr>
                <th class="text-left py-2">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                <th class="text-left py-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th class="text-right py-2">‡∏¢‡∏≠‡∏î</th>
                <th class="text-right py-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th class="text-right py-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="tblInv"></tbody>
          </table>
        </div>
        <div class="card lg:col-span-4">
          <div class="font-semibold mb-2">Payment History</div>
          <ul id="listPayHistory" class="space-y-2 text-sm"></ul>
          <div class="mt-3">
            <div class="text-xs text-slate-500 mb-1">‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏£‡∏ß‡∏°</div>
            <div class="mono text-lg font-semibold" id="totalDue">‡∏ø 0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 3. Documents -->
    <section id="docs">
      <h2 class="text-lg font-semibold mb-3">3) ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Shared Documents)</h2>
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
        <div class="card lg:col-span-12">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">‡∏Ñ‡∏•‡∏±‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div>
            <input id="docSearch" class="px-3 py-1.5 rounded-xl border border-slate-200 text-sm" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£..."/>
          </div>
          <table class="w-full text-sm">
            <thead class="text-slate-500">
              <tr><th class="text-left py-2">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå</th><th class="text-left py-2">‡∏´‡∏°‡∏ß‡∏î</th><th class="text-left py-2">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th><th class="text-right py-2">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</th></tr>
            </thead>
            <tbody id="tblDocs"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 4. Progress Reports -->
    <section id="reports">
      <h2 class="text-lg font-semibold mb-3">4) ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (Shared Reports)</h2>
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
        <div class="card lg:col-span-12">
          <table class="w-full text-sm">
            <thead class="text-slate-500">
              <tr><th class="text-left py-2">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</th><th class="text-left py-2">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</th><th class="text-left py-2">‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÇ‡∏î‡∏¢</th><th class="text-right py-2">‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π/‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</th></tr>
            </thead>
            <tbody id="tblReports"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Drawer -->
  <div id="drawer" class="fixed inset-0 hidden">
    <div class="absolute inset-0 bg-black/30" data-close></div>
    <aside class="absolute right-0 top-0 h-full w-full sm:w-[520px] bg-white border-l border-slate-200 shadow-xl p-5 overflow-y-auto">
      <div class="flex items-center justify-between">
        <div class="font-semibold" id="drawerTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
        <button class="px-3 py-1 rounded-xl bg-slate-900 text-white text-sm" data-close>‡∏õ‡∏¥‡∏î</button>
      </div>
      <div id="drawerBody" class="mt-4 text-sm"></div>
    </aside>
  </div>

  <footer class="max-w-7xl mx-auto px-4 py-10 text-center text-xs text-slate-500">
    ¬© <span id="year"></span> TPRGS.COM ‚Ä¢ Client Portal ‚Ä¢ mock data
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // ---------------- Mock Data ----------------
    const projects = [
      {
        id:'P-204', name:'‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏™‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å', pm:'‡∏ß‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏ä‡∏≤‡∏ç‡∏ä‡∏±‡∏¢', budget: 5400000,
        start:'1 ‡πÄ‡∏°.‡∏¢. 2025', status:'In Progress', percent:68,
        desc:'‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏™‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å ‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠',
        milestones:[
          {title:'‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢', date:'28 ‡∏™.‡∏Ñ. 2025'},
          {title:'‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 5', date:'2 ‡∏Å.‡∏¢. 2025'},
          {title:'‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', date:'3 ‡∏Å.‡∏¢. 2025'},
        ]
      },
      {
        id:'P-318', name:'‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô Q Corp', pm:'‡∏Å‡∏≤‡∏ô‡∏ï‡πå‡∏™‡∏¥‡∏ô‡∏µ ‡∏û‡∏á‡∏©‡πå‡πÑ‡∏ó‡∏¢', budget: 7200000,
        start:'15 ‡∏û.‡∏Ñ. 2025', status:'On Hold', percent:42,
        desc:'‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£',
        milestones:[
          {title:'‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÅ‡∏ö‡∏ö MEP', date:'30 ‡∏™.‡∏Ñ. 2025'},
          {title:'‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á', date:'12 ‡∏Å.‡∏¢. 2025'},
        ]
      }
    ];

    const invoices = [
      {no:'INV-1025', date:'05 ‡∏™.‡∏Ñ. 2025', amount: 320000, status:'Unpaid', pdf:'#'},
      {no:'INV-1020', date:'15 ‡∏Å.‡∏Ñ. 2025', amount: 410000, status:'Overdue', pdf:'#'},
      {no:'INV-1012', date:'20 ‡∏°‡∏¥.‡∏¢. 2025', amount: 285000, status:'Paid', pdf:'#'},
    ];

    const payments = [
      {date:'22 ‡∏°‡∏¥.‡∏¢. 2025', ref:'TRX-88321', amount:285000, note:'INV-1012'},
      {date:'10 ‡∏Å.‡∏Ñ. 2025', ref:'TRX-88990', amount:100000, note:'Retainer top-up'},
    ];

    const documents = [
      {name:'Contract-signed.pdf', cat:'Contracts', updated:'10 ‡πÄ‡∏°.‡∏¢. 2025', url:'#'},
      {name:'Design-Set-R04.zip', cat:'Drawings', updated:'21 ‡∏™.‡∏Ñ. 2025', url:'#'},
      {name:'Minutes-2025-08-15.pdf', cat:'Reports', updated:'15 ‡∏™.‡∏Ñ. 2025', url:'#'},
      {name:'Spec-Civil-v2.pdf', cat:'Specifications', updated:'30 ‡∏Å.‡∏Ñ. 2025', url:'#'},
    ];

    const reports = [
      {name:'Monthly Progress ‚Äì Aug 2025', range:'‡∏™.‡∏Ñ. 2025', by:'Project Manager', url:'#'},
      {name:'Risk Register ‚Äì Q3 Snapshot', range:'‡∏Å.‡∏Ñ.‚Äì‡∏Å.‡∏¢. 2025', by:'PMO', url:'#'},
    ];

    // ---------------- Helpers ----------------
    function baht(n){ return '‡∏ø ' + n.toLocaleString('th-TH'); }
    function $(id){ return document.getElementById(id); }

    // ---------------- Project switch ----------------
    const projectSelect = $('projectSelect');
    projects.forEach(p=>{
      const opt = document.createElement('option');
      opt.value = p.id; opt.textContent = p.id + ' ‚Ä¢ ' + p.name;
      projectSelect.appendChild(opt);
    });
    projectSelect.value = projects[0].id;
    projectSelect.addEventListener('change', ()=> renderProject(projects.find(p=>p.id===projectSelect.value)));

    function renderProject(p){
      $('projectName').textContent = p.name;
      $('pmName').textContent = p.pm;
      $('budget').textContent = baht(p.budget);
      $('startDate').textContent = p.start;
      $('projectDesc').textContent = p.desc;
      $('overallPill').textContent = p.status;
      $('overallPill').className = 'pill ' + (p.status==='In Progress' ? 'bg-sky-100 text-sky-700' : (p.status==='On Hold' ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700'));
      $('progressBar').style.width = p.percent + '%';
      $('progressTxt').textContent = p.percent + '%';

      const ul = $('milestones'); ul.innerHTML='';
      p.milestones.forEach(m=>{
        const li = document.createElement('li');
        li.innerHTML = `<div class="flex items-center justify-between p-3 rounded-xl border border-slate-200">
          <div>${m.title}</div><div class="text-slate-500">${m.date}</div></div>`;
        ul.appendChild(li);
      });

      // update doughnut
      if(window.percentChart) window.percentChart.destroy();
      const ctx = $('chartPercent');
      window.percentChart = new Chart(ctx, {
        type:'doughnut',
        data:{ labels:['‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß','‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠'], datasets:[{ data:[p.percent, 100-p.percent], backgroundColor:['#22c55e','#e2e8f0'] }] },
        options:{ responsive:true, maintainAspectRatio:false, cutout:'70%' }
      });
    }
    renderProject(projects[0]);

    // ---------------- Invoices ----------------
    function renderInvoices(filter='all'){
      const tb = $('tblInv'); tb.innerHTML='';
      let totalDue = 0;
      invoices.filter(inv => filter==='all' ? true : inv.status.toLowerCase()===filter)
        .forEach(inv=>{
          if(inv.status!=='Paid') totalDue += inv.amount;
          const badge = inv.status==='Paid' ? '<span class="pill bg-emerald-100 text-emerald-700">Paid</span>' :
                        inv.status==='Overdue' ? '<span class="pill bg-red-100 text-red-700">Overdue</span>' :
                        '<span class="pill bg-amber-100 text-amber-700">Unpaid</span>';
          const actions = inv.status==='Paid'
            ? `<a class="link" href="${inv.pdf}">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>`
            : `<a class="link mr-3" href="${inv.pdf}">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a><button class="px-2 py-1 rounded-lg bg-sky-600 text-white text-xs" data-pay="${inv.no}">Pay Now</button>`;
          const tr = document.createElement('tr');
          tr.innerHTML = `<td class="py-2">${inv.no}</td>
                          <td class="py-2">${inv.date}</td>
                          <td class="py-2 text-right mono">${baht(inv.amount)}</td>
                          <td class="py-2 text-right">${badge}</td>
                          <td class="py-2 text-right">${actions}</td>`;
          tb.appendChild(tr);
        });
      $('totalDue').textContent = baht(totalDue);
    }
    renderInvoices();
    $('invFilter').addEventListener('change', e=>renderInvoices(e.target.value));

    // CSV export
    $('btn-download-csv').addEventListener('click', ()=>{
      const rows = [['Invoice','Date','Amount','Status'], ...invoices.map(i=>[i.no,i.date,i.amount,i.status])];
      const csv = rows.map(r=>r.join(',')).join('\\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='tprgs-client-invoices.csv'; a.click(); URL.revokeObjectURL(a.href);
    });

    // Payment drawer (mock)
    document.addEventListener('click', e=>{
      const payNo = e.target.getAttribute && e.target.getAttribute('data-pay');
      if(payNo){
        openDrill('‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‚Äì ' + payNo, `
          <div class="space-y-3">
            <div>‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏≤‡∏ò‡∏¥‡∏ï):</div>
            <div class="grid grid-cols-2 gap-2">
              <button class="px-3 py-2 rounded-xl border">‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</button>
              <button class="px-3 py-2 rounded-xl border">e-Transfer</button>
            </div>
            <div class="text-xs text-slate-500">* ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏ò‡∏¥‡∏ï ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á</div>
            <button id="btn-mock-pay" class="px-3 py-2 rounded-xl bg-emerald-600 text-white">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏à‡∏≥‡∏•‡∏≠‡∏á)</button>
          </div>
        `);
      }
    });

    // Payment History
    function renderPayments(){
      const ul = $('listPayHistory'); ul.innerHTML='';
      payments.forEach(p=>{
        const li = document.createElement('li');
        li.innerHTML = `<div class="flex items-center justify-between p-3 rounded-xl border border-slate-200">
          <div>
            <div class="font-medium">${p.date}</div>
            <div class="text-xs text-slate-500">${p.note} ‚Ä¢ ref ${p.ref}</div>
          </div>
          <div class="mono">${baht(p.amount)}</div>
        </div>`;
        ul.appendChild(li);
      });
    }
    renderPayments();

    // ---------------- Documents ----------------
    function renderDocs(q=''){
      const tb = $('tblDocs'); tb.innerHTML='';
      documents.filter(d=> d.name.toLowerCase().includes(q.toLowerCase()) || d.cat.toLowerCase().includes(q.toLowerCase()))
        .forEach(d=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `<td class="py-2">${d.name}</td>
                          <td class="py-2">${d.cat}</td>
                          <td class="py-2">${d.updated}</td>
                          <td class="py-2 text-right"><a class="link" href="${d.url}">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a></td>`;
          tb.appendChild(tr);
        });
    }
    renderDocs();
    $('docSearch').addEventListener('input', e=>renderDocs(e.target.value));

    // ---------------- Reports ----------------
    function renderReports(){
      const tb = $('tblReports'); tb.innerHTML='';
      reports.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="py-2">${r.name}</td>
                        <td class="py-2">${r.range}</td>
                        <td class="py-2">${r.by}</td>
                        <td class="py-2 text-right"><a class="link" href="${r.url}">‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π</a></td>`;
        tb.appendChild(tr);
      });
    }
    renderReports();

    // ---------------- Drawer helpers ----------------
    const drawer = $('drawer');
    function openDrill(title, html){ $('drawerTitle').textContent = title; $('drawerBody').innerHTML = html; drawer.classList.remove('hidden'); }
    function closeDrill(){ drawer.classList.add('hidden'); }
    drawer.querySelectorAll('[data-close]').forEach(b=>b.addEventListener('click', closeDrill));
    document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeDrill(); });
    document.addEventListener('click', e=>{
      if(e.target && e.target.id === 'btn-mock-pay'){
        e.target.outerHTML = '<div class="p-3 rounded-xl bg-emerald-50 text-emerald-700">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</div>';
      }
    });

    // ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ PM
    $('btn-contact-pm').addEventListener('click', ()=>{
      openDrill('‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', `
        <div class="space-y-3">
          <div>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ PM (mock):</div>
          <input class="w-full px-3 py-2 rounded-xl border" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠"/>
          <textarea class="w-full px-3 py-2 rounded-xl border" rows="5" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..."></textarea>
          <button class="px-3 py-2 rounded-xl bg-sky-600 text-white">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
        </div>
      `);
    });

    // ---------------- Export PNG ----------------
    document.getElementById('btn-export').addEventListener('click', async ()=>{
      if(!window.html2canvas){
        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
        s.onload = doExport; document.body.appendChild(s);
      } else { doExport(); }
      async function doExport(){
        const node = document.querySelector('main');
        const canvas = await html2canvas(node, {backgroundColor:'#ffffff', scale:2});
        const a = document.createElement('a'); a.href = canvas.toDataURL('image/png'); a.download = 'tprgs-client-portal.png'; a.click();
      }
    });
  </script>
</body>
</html>
